Index: app/src/main/java/com/erencol/sermon/view/activities/MainActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.erencol.sermon.view.activities;\r\n\r\nimport android.app.AlertDialog;\r\nimport android.content.DialogInterface;\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.view.Menu;\r\nimport android.view.MenuItem;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.databinding.DataBindingUtil;\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\nimport com.android.billingclient.api.BillingClient;\r\nimport com.android.billingclient.api.BillingClientStateListener;\r\nimport com.android.billingclient.api.BillingResult;\r\nimport com.android.billingclient.api.PendingPurchasesParams;\r\nimport com.android.billingclient.api.Purchase;\r\nimport com.android.billingclient.api.PurchasesUpdatedListener;\r\nimport com.android.billingclient.api.QueryPurchasesParams;\r\nimport com.erencol.sermon.Data.service.manager.PremiumManager;\r\nimport com.erencol.sermon.view.adapters.SermonAdapter;\r\nimport com.erencol.sermon.databinding.ActivityMainBinding;\r\nimport com.erencol.sermon.viewmodelpkg.MainViewModel;\r\nimport java.util.List;\r\nimport java.util.Observable;\r\nimport java.util.Observer;\r\nimport com.erencol.sermon.R;\r\n\r\npublic class MainActivity extends AppCompatActivity implements Observer, PurchasesUpdatedListener {\r\n    private MainViewModel mainViewModel;\r\n    private ActivityMainBinding binding;\r\n    private BillingClient billingClient;\r\n    private PremiumManager premiumManager;\r\n    private SermonAdapter sermonAdapter;\r\n    private static final String PREMIUM_SKU = \"premium\"; // Google Play Console'da tanımladığınız SKU ID'si\r\n    \r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        initDataBinding();\r\n        initBillingClient();\r\n        checkisPremium();\r\n    }\r\n\r\n    private void initBillingClient() {\r\n        PendingPurchasesParams pendingPurchasesParams = PendingPurchasesParams.newBuilder()\r\n                .enableOneTimeProducts()\r\n                .build();\r\n        \r\n        billingClient = BillingClient.newBuilder(this)\r\n                .setListener(this)\r\n                .enablePendingPurchases(pendingPurchasesParams)\r\n                .build();\r\n        \r\n        billingClient.startConnection(new BillingClientStateListener() {\r\n            @Override\r\n            public void onBillingSetupFinished(BillingResult billingResult) {\r\n                if (billingResult.getResponseCode() == BillingClient.BillingResponseCode.OK) {\r\n                    queryPurchases();\r\n                }\r\n            }\r\n\r\n            @Override\r\n            public void onBillingServiceDisconnected() {\r\n                // Billing servisi bağlantısı kesildi, tekrar bağlanmayı dene\r\n            }\r\n        });\r\n    }\r\n\r\n    private void queryPurchases() {\r\n        billingClient.queryPurchasesAsync(\r\n            QueryPurchasesParams.newBuilder()\r\n                .setProductType(BillingClient.ProductType.INAPP)\r\n                .build(),\r\n            (billingResult, purchases) -> {\r\n                if (billingResult.getResponseCode() == BillingClient.BillingResponseCode.OK) {\r\n                    handlePurchases(purchases);\r\n                }\r\n            }\r\n        );\r\n    }\r\n\r\n    private void handlePurchases(List<Purchase> purchases) {\r\n        boolean isPremium = false;\r\n        for (Purchase purchase : purchases) {\r\n            if (purchase.getProducts().contains(PREMIUM_SKU) && purchase.getPurchaseState() == Purchase.PurchaseState.PURCHASED) {\r\n                isPremium = true;\r\n                break;\r\n            }\r\n        }\r\n        premiumManager.setPremium(isPremium);\r\n        updateAdapterPremiumStatus();\r\n    }\r\n\r\n    public void checkisPremium(){\r\n        // Premium durumu adapter'a geçirilecek\r\n        updateAdapterPremiumStatus();\r\n    }\r\n    \r\n    private void updateAdapterPremiumStatus() {\r\n        if (sermonAdapter != null) {\r\n            sermonAdapter.setPremium(premiumManager.isPremium());\r\n        }\r\n    }\r\n\r\n    public void initDataBinding(){\r\n        premiumManager = PremiumManager.getInstance(getApplicationContext());\r\n        binding = DataBindingUtil.setContentView(this,R.layout.activity_main);\r\n        mainViewModel = new MainViewModel();\r\n        binding.setMainViewModel(mainViewModel);\r\n        binding.setLifecycleOwner(this);\r\n        setSupportActionBar(binding.toolbar);\r\n        setListSermonListview(binding.sermonsRecyclerview);\r\n        setupObserver(mainViewModel);\r\n    }\r\n\r\n    private void showPremiumDialog() {\r\n        new AlertDialog.Builder(this)\r\n                .setTitle(\"Premium İçerik\")\r\n                .setMessage(\"Bu içerik sadece premium kullanıcılar için. Premium sürümü satın almak ister misiniz?\")\r\n                .setPositiveButton(\"Satın Al\", new DialogInterface.OnClickListener() {\r\n                    @Override\r\n                    public void onClick(DialogInterface dialog, int which) {\r\n\r\n                    }\r\n                })\r\n                .setNegativeButton(\"İptal\", null)\r\n                .show();\r\n    }\r\n\r\n    @Override\r\n    public boolean onCreateOptionsMenu(Menu menu) {\r\n        getMenuInflater().inflate(R.menu.menu_main,menu);\r\n        return true;\r\n    }\r\n\r\n    public void setupObserver(Observable observable) {\r\n        observable.addObserver(this);\r\n    }\r\n    private void setListSermonListview(RecyclerView listPeople) {\r\n        sermonAdapter = new SermonAdapter();\r\n        sermonAdapter.setPremium(premiumManager.isPremium());\r\n        listPeople.setAdapter(sermonAdapter);\r\n        listPeople.setLayoutManager(new LinearLayoutManager(this));\r\n        mainViewModel.getSermons();\r\n    }\r\n\r\n    @Override\r\n    public boolean onOptionsItemSelected(MenuItem item) {\r\n        int id = item.getItemId();\r\n        if (id == R.id.aboutid) {\r\n            showPremiumDialog();\r\n            //showAboutActivity();\r\n            return true;\r\n        } else if (id == R.id.specialdaysid) {\r\n            goToSpecialDaysActivity();\r\n            return true;\r\n        } else if (id == R.id.settingsid) {\r\n            goToSettingsActivity();\r\n            return true;\r\n        } /* else if (id == R.id.qiblaId) {\r\n            goToQibla();\r\n            return true;\r\n        }*/\r\n        else {\r\n            return super.onOptionsItemSelected(item);\r\n        }\r\n    }\r\n\r\n    public void goToSpecialDaysActivity(){\r\n        Intent i = new Intent(MainActivity.this, SpecialDaysActivity.class);\r\n        startActivity(i);\r\n    }\r\n\r\n    public void goToSettingsActivity(){\r\n        Intent i = new Intent(MainActivity.this,SettingsActivity.class);\r\n        startActivity(i);\r\n    }\r\n\r\n    public void showAboutActivity(){\r\n        Intent i = new Intent(MainActivity.this, AboutActivity.class);\r\n        startActivity(i);\r\n    }\r\n\r\n    public void goToQibla(){\r\n        Intent i = new Intent(MainActivity.this, CompassActivity.class);\r\n        startActivity(i);\r\n    }\r\n\r\n    @Override public void update(Observable observable, Object data) {\r\n        if (observable instanceof MainViewModel mainViewModel) {\r\n            SermonAdapter adapter = (SermonAdapter) binding.sermonsRecyclerview.getAdapter();\r\n            assert adapter != null;\r\n            adapter.setSermonList(mainViewModel.getSermonList().getValue());\r\n            adapter.setPremium(premiumManager.isPremium());\r\n        }\r\n    }\r\n    \r\n    @Override\r\n    public void onPurchasesUpdated(BillingResult billingResult, List<Purchase> purchases) {\r\n        if (billingResult.getResponseCode() == BillingClient.BillingResponseCode.OK && purchases != null) {\r\n            handlePurchases(purchases);\r\n        }\r\n    }\r\n    \r\n    @Override\r\n    protected void onResume() {\r\n        super.onResume();\r\n        // Her activity'ye dönüldüğünde premium durumunu kontrol et\r\n        if (billingClient != null && billingClient.isReady()) {\r\n            queryPurchases();\r\n        }\r\n    }\r\n    \r\n    @Override\r\n    protected void onDestroy() {\r\n        super.onDestroy();\r\n        if (billingClient != null) {\r\n            billingClient.endConnection();\r\n        }\r\n    }\r\n\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/erencol/sermon/view/activities/MainActivity.java b/app/src/main/java/com/erencol/sermon/view/activities/MainActivity.java
--- a/app/src/main/java/com/erencol/sermon/view/activities/MainActivity.java	(revision ce660af7120dd023794f7ef487ec6c138b593089)
+++ b/app/src/main/java/com/erencol/sermon/view/activities/MainActivity.java	(date 1767546750732)
@@ -4,6 +4,7 @@
 import android.content.DialogInterface;
 import android.content.Intent;
 import android.os.Bundle;
+import android.util.Log;
 import android.view.Menu;
 import android.view.MenuItem;
 import androidx.appcompat.app.AppCompatActivity;
@@ -63,6 +64,7 @@
             @Override
             public void onBillingServiceDisconnected() {
                 // Billing servisi bağlantısı kesildi, tekrar bağlanmayı dene
+                Log.d("","");
             }
         });
     }
@@ -143,6 +145,7 @@
         listPeople.setAdapter(sermonAdapter);
         listPeople.setLayoutManager(new LinearLayoutManager(this));
         mainViewModel.getSermons();
+        showPremiumDialog();
     }
 
     @Override
